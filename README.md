This repository provides a modular VPC module for AWS networking infrastructure that can be reused across environments. It also includes an example networking stack demonstrating best practices for wiring modules in a root configuration. IAM roles and policies are dynamically generated with `data.aws_caller_identity` and `aws_iam_policy_document` to avoid hard‑coding account IDs in source files. The repository conforms to the standard Terraform module structure with clear separation of `modules/` and `examples/`, enabling compatibility with the Terraform Registry. A remote state backend powered by S3 and DynamoDB ensures state locking and secure storage, with explicit IAM permission management prescribed. Comprehensive documentation, variables, and outputs help accelerate adoption and support automated CI/CD workflows.

## Prerequisites
- Terraform **v1.0.0** or later and the **AWS CLI** configured with valid credentials.
- An AWS principal with permissions to manage S3 buckets, DynamoDB tables, IAM roles/policies, and VPC networking resources.

## Repository Structure
- Follows the standard Terraform module layout with a `modules/` directory for child modules and an `examples/` directory for usage demos.
- Each module contains **`main.tf`**, **`variables.tf`**, and **`outputs.tf`** files, adhering to naming conventions and explicit input/output contracts.
- Root‑level files include **`provider.tf`** (AWS provider), **`backend.tf`** (remote state backend), and **`variables.tf`** (global variables).

## Modules

### VPC Module (`modules/vpc`)
- Provisions an AWS VPC with DNS support, public and private subnets, and optional NAT gateways.
- **Inputs**: CIDR block, lists of public/private AZs, name prefix, and custom tags for flexible deployments.
- **Outputs**: VPC ID, public subnet IDs, and private subnet IDs for downstream modules or tooling.

## Examples
- **`examples/networking`** shows how to instantiate the VPC module without modifying its internals.
- Demonstrates variable definitions in **`variables.tf`** and environment overrides via **`terraform.tfvars`**.

## IAM Role & Policy
- Creates an IAM role using `aws_iam_role` with its trust policy generated by the `aws_iam_policy_document` data source for clear, error‑checked JSON.
- Fetches the current AWS account ID via `data.aws_caller_identity.current` to avoid embedding account IDs in version control.
- Attaches the pre‑created `TerraformStateAccess` managed policy to grant S3 and DynamoDB permissions for remote state operations.

## Remote State Backend
- Configures Terraform remote state in an S3 bucket with encryption and versioning, and enables state locking via a DynamoDB table.
- Supplies backend settings at init time using CLI flags or a config file to work around interpolation limitations in `backend.tf`.
- Both the S3 bucket and DynamoDB table must be provisioned manually (or via a bootstrap script) before running `terraform init`.

## Usage

Run the following to configure and provision your infrastructure:
```bash
terraform init \
  -backend-config="bucket=my-tf-state-bucket" \
  -backend-config="key=env/dev/terraform.tfstate" \
  -backend-config="region=us-west-2" \
  -backend-config="dynamodb_table=terraform-locks" \
  -reconfigure
terraform plan
terraform apply
